{% extends 'admin_base.html' %}

{% load static %}
{% load custom_filters %}

{% block title %}Admin Home{% endblock %}

{% block content %}
<!-- =================================== Navbar Begin ====================================== -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <button class="navbar-toggler mb-3" type="button" data-bs-toggle="collapse" 
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" 
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav d-flex align-items-center me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="btn text-white" href="{% url "custom_admin:admin_home" %}" 
                            style="background-color: #800020;">
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_users" %}" >
                            Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_orders" %}" >
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_products" %}" >
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_categories" %}" >
                            Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_usages" %}" >
                            Dress Type
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn text-black" href="{% url "custom_admin:admin_measurements" %}">
                            Measurements
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav d-flex flex-row justify-content-center  ms-auto mb-2 mb-lg-0">
                    <li class="nav-item ms-3 ms-lg-0">
                        <a class="nav-link" href="{% url "main:home" %}">UserHome</a>
                    </li>
                    <li class="nav-item ms-3 ms-lg-0">
                        <form id="logout-form" action="/accounts/logout/" method="post">
                            {% csrf_token %}
                            <button type="submit" class="nav-link btn btn-link">Logout</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
<!-- =========================== Navbar End =========================== -->

<!-- =========================== Graph section begin =========================== -->

    <!-- Sample chart model -->
    <div class="container d-flex flex-column flex-lg-row gap-3">
        <div class="container my-5 shadow" >
            <select class="form-select form-select-sm w-25 mx-auto mt-2" 
                id="year-orders" name="year-orders">
                {% for year in unique_years  %}
                <option value="{{year}}" {% if year == current_year %} selected {% endif %}>
                    {{year}}
                </option>
                {% endfor %}
            </select>
            <canvas id="chart-orders" style="max-width: 100%; height: 100%;"></canvas>
        </div>
        <div class="container my-5 shadow">
            <select class="form-select form-select-sm w-25 mx-auto mt-2" 
                id="year-sales" name="year-sales">
                {% for year in unique_years  %}
                <option value="{{year}}" {% if year == current_year %} selected {% endif %}>
                    {{year}}
                </option>
                {% endfor %}
            </select>
            <canvas id="chart-sales" style="max-width: 100%; height: 100%;"></canvas>
        </div>
    </div>
    
    


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
    const ctx1 = document.getElementById('chart-orders');
    const ctx2 = document.getElementById('chart-sales');
    
    let chartOrders = new Chart(ctx1, {
        type: 'bar',
        data: {
        labels: [{% for month in months_orders.keys %}'{{ month }}',{% endfor %}],
        datasets: [{
            label: 'Monthly Orders',
            data: [{% for order in months_orders.values %}'{{ order }}',{% endfor %}],
            borderWidth: 2,
            backgroundColor: 'rgba(128,0,32, 0.8)'
        }]
        },
        options: {
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Months'
                }
            },
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Number of Orders'
                }
            }
        }
        }
    });

    let chartSales = new Chart(ctx2, {
        type: 'line',
        data: {
        labels: [{% for month in months_sales.keys %}'{{ month }}',{% endfor %}],
        datasets: [{
            label: 'Monthly Sales',
            data: [{% for sale in months_sales.values %}'{{ sale }}',{% endfor %}],
            borderWidth: 2,
            borderColor: 'rgba(128,0,32, 1)',
            backgroundColor: 'rgba(128,0,32, 0.2)',
            fill: true,
            tension: 0.2
        }]
        },
        options: {
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Months'
                }
            },
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Rupees'
                }
            }
        }
        }
    });

    // To send axios upon change in select year for monthly orders chart.
    document.getElementById('year-orders').addEventListener('change', function(){
        const selectedYear = this.value;
        const csrfToken = "{{ csrf_token }}";

        axios.post('/custom_admin/',{
            'year': selectedYear
        },{
            
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => {
            data = response.data
            console.log('Response recieved successfully', data)

            // Update chart data for chartOrders
            const monthsOrdersKeys = Object.keys(data.months_orders);
            const monthsOrdersValues = Object.values(data.months_orders);
            chartOrders.data.labels = monthsOrdersKeys;
            chartOrders.data.datasets[0].data = monthsOrdersValues;
            chartOrders.update();

        })
        .catch(error => {
            console.error('Error response recieved', error)
        });
    });

    // To send axios upon change in select year for monthly sales chart.
    document.getElementById('year-sales').addEventListener('change', function(){
        const selectedYear = this.value;
        const csrfToken = "{{ csrf_token }}";

        axios.post('/custom_admin/',{
            'year': selectedYear
        },{
            
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => {
            data = response.data
            console.log('Response recieved successfully', data)

            // Update chart data for chartOrders
            const monthsSalesKeys = Object.keys(data.months_sales);
            const monthsSalesValues = Object.values(data.months_sales);
            chartSales.data.labels = monthsSalesKeys;
            chartSales.data.datasets[0].data = monthsSalesValues;
            chartSales.update();

        })
        .catch(error => {
            console.error('Error response recieved', error)
        });
    });
    </script>
      
<!-- =========================== Graph section End =========================== -->


{% endblock  %}